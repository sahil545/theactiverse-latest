{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/utils/request-queue.ts","../../server/utils/fetch-with-timeout.ts","../../server/routes/vendors.ts","../../server/routes/products.ts","../../server/routes/categories.ts","../../server/routes/ratings.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\r\nimport { DemoResponse } from \"@shared/api\";\r\n\r\nexport const handleDemo: RequestHandler = (req, res) => {\r\n  const response: DemoResponse = {\r\n    message: \"Hello from Express server\",\r\n  };\r\n  res.status(200).json(response);\r\n};\r\n","/**\r\n * Simple request queue to throttle API requests and prevent rate limiting\r\n */\r\n\r\ninterface QueuedRequest {\r\n  key: string;\r\n  fn: () => Promise<any>;\r\n  resolve: (value: any) => void;\r\n  reject: (error: any) => void;\r\n}\r\n\r\nclass RequestQueue {\r\n  private queue: QueuedRequest[] = [];\r\n  private processing = false;\r\n  private requestTimestamps = new Map<string, number[]>();\r\n  private maxRequestsPerSecond = 2; // Max 2 requests per second per endpoint\r\n  private minIntervalBetweenRequests = 500; // Minimum 500ms between requests to same endpoint\r\n\r\n  async enqueue<T>(key: string, fn: () => Promise<T>): Promise<T> {\r\n    return new Promise((resolve, reject) => {\r\n      this.queue.push({ key, fn, resolve, reject });\r\n      this.process();\r\n    });\r\n  }\r\n\r\n  private async process() {\r\n    if (this.processing || this.queue.length === 0) {\r\n      return;\r\n    }\r\n\r\n    this.processing = true;\r\n\r\n    while (this.queue.length > 0) {\r\n      const request = this.queue.shift();\r\n      if (!request) break;\r\n\r\n      try {\r\n        // Wait if needed to respect rate limiting\r\n        await this.waitIfNeeded(request.key);\r\n\r\n        // Track this request\r\n        this.recordRequest(request.key);\r\n\r\n        // Execute the request\r\n        const result = await request.fn();\r\n        request.resolve(result);\r\n      } catch (error) {\r\n        request.reject(error);\r\n      }\r\n\r\n      // Small delay between requests to different endpoints\r\n      await this.delay(100);\r\n    }\r\n\r\n    this.processing = false;\r\n  }\r\n\r\n  private waitIfNeeded(key: string): Promise<void> {\r\n    return new Promise((resolve) => {\r\n      const timestamps = this.requestTimestamps.get(key) || [];\r\n      const now = Date.now();\r\n\r\n      // Remove timestamps older than 1 second\r\n      const recentTimestamps = timestamps.filter(\r\n        (ts) => now - ts < 1000\r\n      );\r\n\r\n      if (recentTimestamps.length >= this.maxRequestsPerSecond) {\r\n        // Wait until oldest request expires\r\n        const oldestTimestamp = recentTimestamps[0];\r\n        const waitTime = Math.max(0, oldestTimestamp + 1000 - now + 100);\r\n        setTimeout(resolve, waitTime);\r\n      } else {\r\n        // Check if enough time has passed since last request\r\n        if (recentTimestamps.length > 0) {\r\n          const lastTimestamp = recentTimestamps[recentTimestamps.length - 1];\r\n          const timeSinceLastRequest = now - lastTimestamp;\r\n          if (timeSinceLastRequest < this.minIntervalBetweenRequests) {\r\n            const waitTime =\r\n              this.minIntervalBetweenRequests - timeSinceLastRequest;\r\n            setTimeout(resolve, waitTime);\r\n          } else {\r\n            resolve();\r\n          }\r\n        } else {\r\n          resolve();\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private recordRequest(key: string): void {\r\n    const now = Date.now();\r\n    const timestamps = this.requestTimestamps.get(key) || [];\r\n\r\n    // Remove timestamps older than 1 second\r\n    const recentTimestamps = timestamps.filter((ts) => now - ts < 1000);\r\n    recentTimestamps.push(now);\r\n\r\n    this.requestTimestamps.set(key, recentTimestamps);\r\n  }\r\n\r\n  private delay(ms: number): Promise<void> {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const requestQueue = new RequestQueue();\r\n","/**\r\n * Fetch with timeout to prevent hanging requests on Netlify\r\n */\r\nexport async function fetchWithTimeout(\r\n  url: string,\r\n  options: RequestInit & { timeout?: number } = {}\r\n): Promise<Response> {\r\n  const { timeout = 10000, ...fetchOptions } = options;\r\n\r\n  const controller = new AbortController();\r\n  const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n\r\n  try {\r\n    const response = await fetch(url, {\r\n      ...fetchOptions,\r\n      signal: controller.signal,\r\n    });\r\n    clearTimeout(timeoutId);\r\n    return response;\r\n  } catch (error) {\r\n    clearTimeout(timeoutId);\r\n    if (error instanceof Error && error.name === 'AbortError') {\r\n      throw new Error(`Request timeout after ${timeout}ms`);\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n","import { RequestHandler } from \"express\";\r\nimport { requestQueue } from \"../utils/request-queue\";\r\nimport { fetchWithTimeout } from \"../utils/fetch-with-timeout\";\r\n\r\nconst LARAVEL_API_URL = \"https://admin.theactiverse.com/api\";\r\n\r\n// Simple in-memory cache with TTL\r\nconst vendorsCache = new Map<\r\n  string,\r\n  { data: any; timestamp: number }\r\n>();\r\nconst CACHE_TTL = 10 * 60 * 1000; // 10 minutes\r\n\r\nfunction getCacheKey(...args: any[]): string {\r\n  return JSON.stringify(args);\r\n}\r\n\r\nfunction getCachedData(key: string): any | null {\r\n  const cached = vendorsCache.get(key);\r\n  if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\r\n    return cached.data;\r\n  }\r\n  vendorsCache.delete(key);\r\n  return null;\r\n}\r\n\r\nfunction setCachedData(key: string, data: any): void {\r\n  vendorsCache.set(key, { data, timestamp: Date.now() });\r\n}\r\n\r\nexport interface Vendor {\r\n  id: number;\r\n  name: string;\r\n  email: string;\r\n  email_verified_at: string | null;\r\n  photo: string | null;\r\n  role: string;\r\n  username: string;\r\n  status: number;\r\n  phone_number: string | null;\r\n  address: string | null;\r\n  social_id: string | null;\r\n  social_type: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  vendor_id: number;\r\n  shop_name: string;\r\n  shop_description: string | null;\r\n}\r\n\r\ninterface VendorsResponse {\r\n  status: boolean;\r\n  data: Vendor[];\r\n}\r\n\r\nexport const handleGetVendors: RequestHandler = async (req, res) => {\r\n  try {\r\n    const cacheKey = getCacheKey(\"vendors\");\r\n\r\n    // Check cache first\r\n    const cachedData = getCachedData(cacheKey);\r\n    if (cachedData) {\r\n      return res.json(cachedData);\r\n    }\r\n\r\n    // Use request queue to prevent rate limiting\r\n    try {\r\n      const data: VendorsResponse = await requestQueue.enqueue(\r\n        \"vendors\",\r\n        async () => {\r\n          const response = await fetchWithTimeout(`${LARAVEL_API_URL}/users`, { timeout: 10000 });\r\n\r\n          if (!response.ok) {\r\n            throw new Error(\r\n              `Laravel API responded with status ${response.status}`\r\n            );\r\n          }\r\n\r\n          return response.json();\r\n        }\r\n      );\r\n\r\n      if (data.status && Array.isArray(data.data)) {\r\n        const vendors = data.data.filter(\r\n          (user: Vendor) => user.role === \"vendor\" && user.status === 1,\r\n        );\r\n        const responseData = { status: true, data: vendors };\r\n        // Cache successful response\r\n        setCachedData(cacheKey, responseData);\r\n        return res.json(responseData);\r\n      }\r\n    } catch (error) {\r\n      // If API fails, return empty data gracefully\r\n      console.warn(\"Laravel API error, returning empty vendors:\", error);\r\n    }\r\n\r\n    res.json({ status: false, data: [] });\r\n  } catch (error) {\r\n    console.error(\"Error in handleGetVendors:\", error);\r\n    res.json({\r\n      status: false,\r\n      data: [],\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport { requestQueue } from \"../utils/request-queue\";\r\nimport { fetchWithTimeout } from \"../utils/fetch-with-timeout\";\r\n\r\nconst LARAVEL_API_URL = \"https://admin.theactiverse.com/api\";\r\n\r\n// Simple in-memory cache with TTL\r\nconst productsCache = new Map<\r\n  string,\r\n  { data: any; timestamp: number }\r\n>();\r\nconst CACHE_TTL = 10 * 60 * 1000; // 10 minutes\r\n\r\nfunction getCacheKey(...args: any[]): string {\r\n  return JSON.stringify(args);\r\n}\r\n\r\nfunction getCachedData(key: string): any | null {\r\n  const cached = productsCache.get(key);\r\n  if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\r\n    return cached.data;\r\n  }\r\n  productsCache.delete(key);\r\n  return null;\r\n}\r\n\r\nfunction setCachedData(key: string, data: any): void {\r\n  productsCache.set(key, { data, timestamp: Date.now() });\r\n}\r\n\r\nexport interface Product {\r\n  product_id: number;\r\n  product_name: string;\r\n  product_code: string;\r\n  product_tags: string;\r\n  product_colors: string;\r\n  product_sizes?: string;\r\n  product_short_description: string;\r\n  product_long_description: string | null;\r\n  product_slug: string;\r\n  product_price: number;\r\n  product_thumbnail: string;\r\n  product_status: string;\r\n  sub_category_id: number;\r\n  brand_id: number;\r\n  vendor_id: number;\r\n  product_quantity: number;\r\n  gallery_images?: string[];\r\n}\r\n\r\ninterface ProductsResponse {\r\n  status: boolean;\r\n  data: Product[];\r\n}\r\n\r\nexport const handleGetProducts: RequestHandler = async (req, res) => {\r\n  try {\r\n    const cacheKey = getCacheKey(\"products\");\r\n\r\n    // Check cache first\r\n    const cachedData = getCachedData(cacheKey);\r\n    if (cachedData) {\r\n      return res.json(cachedData);\r\n    }\r\n\r\n    // Use request queue to prevent rate limiting\r\n    try {\r\n      const data: ProductsResponse = await requestQueue.enqueue(\r\n        \"products\",\r\n        async () => {\r\n          const response = await fetchWithTimeout(`${LARAVEL_API_URL}/products`, { timeout: 10000 });\r\n\r\n          if (!response.ok) {\r\n            throw new Error(\r\n              `Laravel API responded with status ${response.status}`\r\n            );\r\n          }\r\n\r\n          return response.json();\r\n        }\r\n      );\r\n\r\n      if (data.status && Array.isArray(data.data)) {\r\n        const activeProducts = data.data.filter(\r\n          (product) => product.product_status === \"1\",\r\n        );\r\n        const responseData = { status: true, data: activeProducts };\r\n        // Cache successful response\r\n        setCachedData(cacheKey, responseData);\r\n        return res.json(responseData);\r\n      }\r\n    } catch (error) {\r\n      // If API fails, return empty data gracefully\r\n      console.warn(\"Laravel API error, returning empty products:\", error);\r\n    }\r\n\r\n    res.json({ status: false, data: [] });\r\n  } catch (error) {\r\n    console.error(\"Error in handleGetProducts:\", error);\r\n    res.json({\r\n      status: false,\r\n      data: [],\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport { requestQueue } from \"../utils/request-queue\";\r\nimport { fetchWithTimeout } from \"../utils/fetch-with-timeout\";\r\n\r\nconst LARAVEL_API_URL = \"https://admin.theactiverse.com/api\";\r\n\r\n// Simple in-memory cache with TTL\r\nconst categoriesCache = new Map<\r\n  string,\r\n  { data: any; timestamp: number }\r\n>();\r\nconst CACHE_TTL = 10 * 60 * 1000; // 10 minutes\r\n\r\nfunction getCacheKey(...args: any[]): string {\r\n  return JSON.stringify(args);\r\n}\r\n\r\nfunction getCachedData(key: string): any | null {\r\n  const cached = categoriesCache.get(key);\r\n  if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\r\n    return cached.data;\r\n  }\r\n  categoriesCache.delete(key);\r\n  return null;\r\n}\r\n\r\nfunction setCachedData(key: string, data: any): void {\r\n  categoriesCache.set(key, { data, timestamp: Date.now() });\r\n}\r\n\r\nexport interface Category {\r\n  id: number;\r\n  category_name: string;\r\n  category_slug: string;\r\n  category_image?: string;\r\n  category_description?: string;\r\n}\r\n\r\ninterface CategoriesResponse {\r\n  status: boolean;\r\n  data: Category[];\r\n}\r\n\r\nexport const handleGetCategories: RequestHandler = async (req, res) => {\r\n  try {\r\n    const cacheKey = getCacheKey(\"categories\");\r\n\r\n    // Check cache first\r\n    const cachedData = getCachedData(cacheKey);\r\n    if (cachedData) {\r\n      return res.json(cachedData);\r\n    }\r\n\r\n    // Use request queue to prevent rate limiting\r\n    try {\r\n      const data: CategoriesResponse = await requestQueue.enqueue(\r\n        \"categories\",\r\n        async () => {\r\n          const response = await fetchWithTimeout(`${LARAVEL_API_URL}/categories`, { timeout: 10000 });\r\n\r\n          if (!response.ok) {\r\n            throw new Error(\r\n              `Laravel API responded with status ${response.status}`\r\n            );\r\n          }\r\n\r\n          return response.json();\r\n        }\r\n      );\r\n\r\n      if (data.status && Array.isArray(data.data)) {\r\n        const responseData = { status: true, data: data.data };\r\n        // Cache successful response\r\n        setCachedData(cacheKey, responseData);\r\n        return res.json(responseData);\r\n      }\r\n    } catch (error) {\r\n      // If API fails, return empty data gracefully\r\n      console.warn(\"Laravel API error, returning empty categories:\", error);\r\n    }\r\n\r\n    res.json({ status: false, data: [] });\r\n  } catch (error) {\r\n    console.error(\"Error in handleGetCategories:\", error);\r\n    res.json({\r\n      status: false,\r\n      data: [],\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n};\r\n\r\nexport const handleGetSubCategories: RequestHandler = async (req, res) => {\r\n  try {\r\n    const cacheKey = getCacheKey(\"sub-categories\");\r\n\r\n    // Check cache first\r\n    const cachedData = getCachedData(cacheKey);\r\n    if (cachedData) {\r\n      return res.json(cachedData);\r\n    }\r\n\r\n    // Use request queue to prevent rate limiting\r\n    try {\r\n      const data: SubCategoriesResponse = await requestQueue.enqueue(\r\n        \"sub-categories\",\r\n        async () => {\r\n          const response = await fetchWithTimeout(`${LARAVEL_API_URL}/sub-categories`, { timeout: 10000 });\r\n\r\n          if (!response.ok) {\r\n            throw new Error(\r\n              `Laravel API responded with status ${response.status}`\r\n            );\r\n          }\r\n\r\n          return response.json();\r\n        }\r\n      );\r\n\r\n      if (data.status && Array.isArray(data.data)) {\r\n        const responseData = { status: true, data: data.data };\r\n        // Cache successful response\r\n        setCachedData(cacheKey, responseData);\r\n        return res.json(responseData);\r\n      }\r\n    } catch (error) {\r\n      // If API fails, return empty data gracefully\r\n      console.warn(\"Laravel API error, returning empty sub-categories:\", error);\r\n    }\r\n\r\n    res.json({ status: false, data: [] });\r\n  } catch (error) {\r\n    console.error(\"Error in handleGetSubCategories:\", error);\r\n    res.json({\r\n      status: false,\r\n      data: [],\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n};\r\n\r\nexport interface SubCategory {\r\n  sub_category_id: number;\r\n  sub_category_name: string;\r\n  sub_category_image: string;\r\n  sub_category_slug: string;\r\n  category_id: number;\r\n  created_at: string;\r\n  products?: any[];\r\n}\r\n\r\ninterface SubCategoriesResponse {\r\n  status: boolean;\r\n  data: SubCategory[];\r\n}\r\n\r\nexport interface CategoryWithProducts {\r\n  category_id: number;\r\n  category_name: string;\r\n  category_image: string;\r\n  category_slug: string;\r\n  sub_categories: SubCategory[];\r\n}\r\n\r\ninterface CategoryWithProductsResponse {\r\n  status: boolean;\r\n  data: CategoryWithProducts;\r\n}\r\n\r\nexport const handleGetCategoryWithProducts: RequestHandler = async (req, res) => {\r\n  try {\r\n    const { categoryId } = req.params;\r\n    const cacheKey = getCacheKey(\"category-with-products\", categoryId);\r\n\r\n    // Check cache first\r\n    const cachedData = getCachedData(cacheKey);\r\n    if (cachedData) {\r\n      return res.json(cachedData);\r\n    }\r\n\r\n    // Use request queue to prevent rate limiting\r\n    try {\r\n      const data: CategoryWithProductsResponse = await requestQueue.enqueue(\r\n        `category-with-products-${categoryId}`,\r\n        async () => {\r\n          const response = await fetchWithTimeout(\r\n            `${LARAVEL_API_URL}/categories-with-products/${categoryId}`,\r\n            { timeout: 10000 }\r\n          );\r\n\r\n          if (!response.ok) {\r\n            throw new Error(\r\n              `Laravel API responded with status ${response.status}`\r\n            );\r\n          }\r\n\r\n          return response.json();\r\n        }\r\n      );\r\n\r\n      if (data.status && data.data) {\r\n        const responseData = { status: true, data: data.data };\r\n        // Cache successful response\r\n        setCachedData(cacheKey, responseData);\r\n        return res.json(responseData);\r\n      }\r\n    } catch (error) {\r\n      // If API fails, return empty data gracefully\r\n      console.warn(\r\n        \"Laravel API error, returning empty category with products:\",\r\n        error\r\n      );\r\n    }\r\n\r\n    res.json({ status: false, data: null });\r\n  } catch (error) {\r\n    console.error(\"Error in handleGetCategoryWithProducts:\", error);\r\n    res.json({\r\n      status: false,\r\n      data: null,\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport { requestQueue } from \"../utils/request-queue\";\r\nimport { fetchWithTimeout } from \"../utils/fetch-with-timeout\";\r\n\r\nconst LARAVEL_API_URL = \"https://admin.theactiverse.com/api\";\r\n\r\n// Simple in-memory cache with TTL\r\nconst ratingsCache = new Map<\r\n  string,\r\n  { data: any; timestamp: number }\r\n>();\r\nconst CACHE_TTL = 5 * 60 * 1000; // 5 minutes\r\n\r\nfunction getCacheKey(...args: any[]): string {\r\n  return JSON.stringify(args);\r\n}\r\n\r\nfunction getCachedData(key: string): any | null {\r\n  const cached = ratingsCache.get(key);\r\n  if (cached && Date.now() - cached.timestamp < CACHE_TTL) {\r\n    return cached.data;\r\n  }\r\n  ratingsCache.delete(key);\r\n  return null;\r\n}\r\n\r\nfunction setCachedData(key: string, data: any): void {\r\n  ratingsCache.set(key, { data, timestamp: Date.now() });\r\n}\r\n\r\nexport interface Rating {\r\n  id: number;\r\n  product_id: number;\r\n  user_id: number;\r\n  rating: number;\r\n  comment: string | null;\r\n  helpful_count: number;\r\n  is_approved: boolean;\r\n  user?: {\r\n    id: number;\r\n    name: string;\r\n    photo: string | null;\r\n  };\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface RatingStatistics {\r\n  total_ratings: number;\r\n  average_rating: number;\r\n  rating_distribution: {\r\n    5: number;\r\n    4: number;\r\n    3: number;\r\n    2: number;\r\n    1: number;\r\n  };\r\n}\r\n\r\nexport interface RatingsResponse {\r\n  success?: boolean;\r\n  status?: boolean;\r\n  product_id?: string;\r\n  average_rating?: string | number;\r\n  rating_count?: number;\r\n  ratings: Rating[];\r\n  data?: {\r\n    ratings: Rating[];\r\n    pagination: {\r\n      current_page: number;\r\n      last_page: number;\r\n      total: number;\r\n      per_page: number;\r\n    };\r\n    statistics: RatingStatistics;\r\n  };\r\n  message?: string;\r\n}\r\n\r\nexport const handleGetProductRatings: RequestHandler = async (req, res) => {\r\n  try {\r\n    const { productId } = req.params;\r\n    const page = req.query.page || 1;\r\n\r\n    const cacheKey = getCacheKey(\"ratings\", productId, page);\r\n\r\n    // Check cache first\r\n    const cachedData = getCachedData(cacheKey);\r\n    if (cachedData) {\r\n      return res.json(cachedData);\r\n    }\r\n\r\n    // Use request queue to prevent rate limiting\r\n    try {\r\n      const data: RatingsResponse = await requestQueue.enqueue(\r\n        `ratings-${productId}`,\r\n        async () => {\r\n          const response = await fetchWithTimeout(\r\n            `${LARAVEL_API_URL}/products/${productId}/ratings?page=${page}`,\r\n            {\r\n              method: \"GET\",\r\n              headers: {\r\n                Accept: \"application/json\",\r\n                \"Content-Type\": \"application/json\",\r\n              },\r\n              timeout: 10000,\r\n            }\r\n          );\r\n\r\n          if (!response.ok) {\r\n            throw new Error(\r\n              `Laravel API responded with status ${response.status}`\r\n            );\r\n          }\r\n\r\n          return response.json();\r\n        }\r\n      );\r\n\r\n      if (data && (data.status || data.success)) {\r\n        // Cache successful response\r\n        setCachedData(cacheKey, data);\r\n        return res.json(data);\r\n      }\r\n    } catch (error) {\r\n      // If API fails, return empty ratings gracefully\r\n      console.warn(\r\n        \"Laravel API error, returning empty ratings for product:\",\r\n        productId,\r\n        error\r\n      );\r\n    }\r\n\r\n    res.json({ status: false, ratings: [] });\r\n  } catch (error) {\r\n    console.error(\"Error in handleGetProductRatings:\", error);\r\n    res.json({\r\n      status: false,\r\n      ratings: [],\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n};\r\n\r\nexport const handleGetUserRating: RequestHandler = async (req, res) => {\r\n  try {\r\n    const { productId } = req.params;\r\n    const token = req.headers.authorization?.replace(\"Bearer \", \"\");\r\n\r\n    if (!token) {\r\n      return res.status(401).json({\r\n        status: false,\r\n        message: \"Authentication required\",\r\n      });\r\n    }\r\n\r\n    const response = await fetchWithTimeout(\r\n      `${LARAVEL_API_URL}/products/${productId}/my-rating`,\r\n      {\r\n        method: \"GET\",\r\n        headers: {\r\n          Accept: \"application/json\",\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        timeout: 10000,\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Laravel API responded with status ${response.status}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    res.json(data);\r\n  } catch (error) {\r\n    console.error(\"Error fetching user rating from Laravel API:\", error);\r\n    res.status(500).json({\r\n      status: false,\r\n      data: null,\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n};\r\n\r\nexport const handleCreateOrUpdateRating: RequestHandler = async (req, res) => {\r\n  try {\r\n    const { productId } = req.params;\r\n    const { rating, comment, guest_email, guest_name } = req.body;\r\n    const token = req.headers.authorization?.replace(\"Bearer \", \"\");\r\n\r\n    const headers: Record<string, string> = {\r\n      Accept: \"application/json\",\r\n      \"Content-Type\": \"application/json\",\r\n    };\r\n\r\n    const body: any = {\r\n      rating,\r\n      comment: comment || null,\r\n    };\r\n\r\n    if (token) {\r\n      headers.Authorization = `Bearer ${token}`;\r\n    } else if (guest_email && guest_name) {\r\n      body.guest_email = guest_email;\r\n      body.guest_name = guest_name;\r\n    } else {\r\n      return res.status(400).json({\r\n        status: false,\r\n        message: \"Either authentication token or guest email/name is required\",\r\n      });\r\n    }\r\n\r\n    const response = await fetchWithTimeout(\r\n      `${LARAVEL_API_URL}/products/${productId}/ratings`,\r\n      {\r\n        method: \"POST\",\r\n        headers,\r\n        body: JSON.stringify(body),\r\n        timeout: 10000,\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      throw new Error(\r\n        errorData.message || `API error: ${response.status}`\r\n      );\r\n    }\r\n\r\n    const data = await response.json();\r\n    res.json(data);\r\n  } catch (error) {\r\n    console.error(\"Error creating/updating rating:\", error);\r\n    res.status(500).json({\r\n      status: false,\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n};\r\n\r\nexport const handleDeleteRating: RequestHandler = async (req, res) => {\r\n  try {\r\n    const { ratingId } = req.params;\r\n    const token = req.headers.authorization?.replace(\"Bearer \", \"\");\r\n\r\n    if (!token) {\r\n      return res.status(401).json({\r\n        status: false,\r\n        message: \"Authentication required\",\r\n      });\r\n    }\r\n\r\n    const response = await fetchWithTimeout(`${LARAVEL_API_URL}/ratings/${ratingId}`, {\r\n      method: \"DELETE\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n      timeout: 10000,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Laravel API responded with status ${response.status}`);\r\n    }\r\n\r\n    res.json({ status: true, message: \"Rating deleted successfully\" });\r\n  } catch (error) {\r\n    console.error(\"Error deleting rating:\", error);\r\n    res.status(500).json({\r\n      status: false,\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n};\r\n","import \"dotenv/config\";\r\nimport express from \"express\";\r\nimport cors from \"cors\";\r\nimport { handleDemo } from \"./routes/demo\";\r\nimport { handleGetVendors } from \"./routes/vendors\";\r\nimport { handleGetProducts } from \"./routes/products\";\r\nimport { handleGetCategories, handleGetSubCategories, handleGetCategoryWithProducts } from \"./routes/categories\";\r\nimport {\r\n  handleGetProductRatings,\r\n  handleGetUserRating,\r\n  handleCreateOrUpdateRating,\r\n  handleDeleteRating,\r\n} from \"./routes/ratings\";\r\n\r\nexport function createServer() {\r\n  const app = express();\r\n\r\n  // Middleware\r\n  app.use(cors());\r\n  app.use(express.json());\r\n  app.use(express.urlencoded({ extended: true }));\r\n\r\n  // Example API routes\r\n  app.get(\"/api/ping\", (_req, res) => {\r\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\r\n    res.json({ message: ping });\r\n  });\r\n\r\n  app.get(\"/api/demo\", handleDemo);\r\n  app.get(\"/api/users\", handleGetVendors);\r\n  app.get(\"/api/products\", handleGetProducts);\r\n  app.get(\"/api/categories\", handleGetCategories);\r\n  app.get(\"/api/sub-categories\", handleGetSubCategories);\r\n  app.get(\"/api/categories-with-products/:categoryId\", handleGetCategoryWithProducts);\r\n\r\n  // Ratings routes\r\n  app.get(\"/api/products/:productId/ratings\", handleGetProductRatings);\r\n  app.get(\"/api/products/:productId/my-rating\", handleGetUserRating);\r\n  app.post(\"/api/products/:productId/ratings\", handleCreateOrUpdateRating);\r\n  app.delete(\"/api/ratings/:ratingId\", handleDeleteRating);\r\n\r\n  return app;\r\n}\r\n","import path from \"path\";\r\nimport { createServer } from \"./index\";\r\nimport * as express from \"express\";\r\n\r\nconst app = createServer();\r\nconst port = process.env.PORT || 3000;\r\n\r\n// In production, serve the built SPA files\r\nconst __dirname = import.meta.dirname;\r\nconst distPath = path.join(__dirname, \"../spa\");\r\n\r\n// Serve static files\r\napp.use(express.static(distPath));\r\n\r\n// Handle React Router - serve index.html for all non-API routes\r\napp.get(\"*\", (req, res) => {\r\n  // Don't serve index.html for API routes\r\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\r\n    return res.status(404).json({ error: \"API endpoint not found\" });\r\n  }\r\n\r\n  res.sendFile(path.join(distPath, \"index.html\"));\r\n});\r\n\r\napp.listen(port, () => {\r\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\r\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\r\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\r\n});\r\n\r\n// Graceful shutdown\r\nprocess.on(\"SIGTERM\", () => {\r\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\r\n  process.exit(0);\r\n});\r\n\r\nprocess.on(\"SIGINT\", () => {\r\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\r\n  process.exit(0);\r\n});\r\n"],"names":["LARAVEL_API_URL","CACHE_TTL","getCacheKey","getCachedData","setCachedData","app","express","__dirname"],"mappings":";;;;;AAGO,MAAM,aAA6B,CAAC,KAAK,QAAQ;AACtD,QAAM,WAAyB;AAAA,IAC7B,SAAS;AAAA,EAAA;AAEX,MAAI,OAAO,GAAG,EAAE,KAAK,QAAQ;AAC/B;ACGA,MAAM,aAAa;AAAA,EACT,QAAyB,CAAA;AAAA,EACzB,aAAa;AAAA,EACb,wCAAwB,IAAA;AAAA,EACxB,uBAAuB;AAAA;AAAA,EACvB,6BAA6B;AAAA;AAAA,EAErC,MAAM,QAAW,KAAa,IAAkC;AAC9D,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,WAAK,MAAM,KAAK,EAAE,KAAK,IAAI,SAAS,QAAQ;AAC5C,WAAK,QAAA;AAAA,IACP,CAAC;AAAA,EACH;AAAA,EAEA,MAAc,UAAU;AACtB,QAAI,KAAK,cAAc,KAAK,MAAM,WAAW,GAAG;AAC9C;AAAA,IACF;AAEA,SAAK,aAAa;AAElB,WAAO,KAAK,MAAM,SAAS,GAAG;AAC5B,YAAM,UAAU,KAAK,MAAM,MAAA;AAC3B,UAAI,CAAC,QAAS;AAEd,UAAI;AAEF,cAAM,KAAK,aAAa,QAAQ,GAAG;AAGnC,aAAK,cAAc,QAAQ,GAAG;AAG9B,cAAM,SAAS,MAAM,QAAQ,GAAA;AAC7B,gBAAQ,QAAQ,MAAM;AAAA,MACxB,SAAS,OAAO;AACd,gBAAQ,OAAO,KAAK;AAAA,MACtB;AAGA,YAAM,KAAK,MAAM,GAAG;AAAA,IACtB;AAEA,SAAK,aAAa;AAAA,EACpB;AAAA,EAEQ,aAAa,KAA4B;AAC/C,WAAO,IAAI,QAAQ,CAAC,YAAY;AAC9B,YAAM,aAAa,KAAK,kBAAkB,IAAI,GAAG,KAAK,CAAA;AACtD,YAAM,MAAM,KAAK,IAAA;AAGjB,YAAM,mBAAmB,WAAW;AAAA,QAClC,CAAC,OAAO,MAAM,KAAK;AAAA,MAAA;AAGrB,UAAI,iBAAiB,UAAU,KAAK,sBAAsB;AAExD,cAAM,kBAAkB,iBAAiB,CAAC;AAC1C,cAAM,WAAW,KAAK,IAAI,GAAG,kBAAkB,MAAO,MAAM,GAAG;AAC/D,mBAAW,SAAS,QAAQ;AAAA,MAC9B,OAAO;AAEL,YAAI,iBAAiB,SAAS,GAAG;AAC/B,gBAAM,gBAAgB,iBAAiB,iBAAiB,SAAS,CAAC;AAClE,gBAAM,uBAAuB,MAAM;AACnC,cAAI,uBAAuB,KAAK,4BAA4B;AAC1D,kBAAM,WACJ,KAAK,6BAA6B;AACpC,uBAAW,SAAS,QAAQ;AAAA,UAC9B,OAAO;AACL,oBAAA;AAAA,UACF;AAAA,QACF,OAAO;AACL,kBAAA;AAAA,QACF;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEQ,cAAc,KAAmB;AACvC,UAAM,MAAM,KAAK,IAAA;AACjB,UAAM,aAAa,KAAK,kBAAkB,IAAI,GAAG,KAAK,CAAA;AAGtD,UAAM,mBAAmB,WAAW,OAAO,CAAC,OAAO,MAAM,KAAK,GAAI;AAClE,qBAAiB,KAAK,GAAG;AAEzB,SAAK,kBAAkB,IAAI,KAAK,gBAAgB;AAAA,EAClD;AAAA,EAEQ,MAAM,IAA2B;AACvC,WAAO,IAAI,QAAQ,CAAC,YAAY,WAAW,SAAS,EAAE,CAAC;AAAA,EACzD;AACF;AAGO,MAAM,eAAe,IAAI,aAAA;ACzGhC,eAAsB,iBACpB,KACA,UAA8C,IAC3B;AACnB,QAAM,EAAE,UAAU,KAAO,GAAG,iBAAiB;AAE7C,QAAM,aAAa,IAAI,gBAAA;AACvB,QAAM,YAAY,WAAW,MAAM,WAAW,MAAA,GAAS,OAAO;AAE9D,MAAI;AACF,UAAM,WAAW,MAAM,MAAM,KAAK;AAAA,MAChC,GAAG;AAAA,MACH,QAAQ,WAAW;AAAA,IAAA,CACpB;AACD,iBAAa,SAAS;AACtB,WAAO;AAAA,EACT,SAAS,OAAO;AACd,iBAAa,SAAS;AACtB,QAAI,iBAAiB,SAAS,MAAM,SAAS,cAAc;AACzD,YAAM,IAAI,MAAM,yBAAyB,OAAO,IAAI;AAAA,IACtD;AACA,UAAM;AAAA,EACR;AACF;ACtBA,MAAMA,oBAAkB;AAGxB,MAAM,mCAAmB,IAAA;AAIzB,MAAMC,cAAY,KAAK,KAAK;AAE5B,SAASC,iBAAe,MAAqB;AAC3C,SAAO,KAAK,UAAU,IAAI;AAC5B;AAEA,SAASC,gBAAc,KAAyB;AAC9C,QAAM,SAAS,aAAa,IAAI,GAAG;AACnC,MAAI,UAAU,KAAK,IAAA,IAAQ,OAAO,YAAYF,aAAW;AACvD,WAAO,OAAO;AAAA,EAChB;AACA,eAAa,OAAO,GAAG;AACvB,SAAO;AACT;AAEA,SAASG,gBAAc,KAAa,MAAiB;AACnD,eAAa,IAAI,KAAK,EAAE,MAAM,WAAW,KAAK,IAAA,GAAO;AACvD;AA2BO,MAAM,mBAAmC,OAAO,KAAK,QAAQ;AAClE,MAAI;AACF,UAAM,WAAWF,cAAY,SAAS;AAGtC,UAAM,aAAaC,gBAAc,QAAQ;AACzC,QAAI,YAAY;AACd,aAAO,IAAI,KAAK,UAAU;AAAA,IAC5B;AAGA,QAAI;AACF,YAAM,OAAwB,MAAM,aAAa;AAAA,QAC/C;AAAA,QACA,YAAY;AACV,gBAAM,WAAW,MAAM,iBAAiB,GAAGH,iBAAe,UAAU,EAAE,SAAS,KAAO;AAEtF,cAAI,CAAC,SAAS,IAAI;AAChB,kBAAM,IAAI;AAAA,cACR,qCAAqC,SAAS,MAAM;AAAA,YAAA;AAAA,UAExD;AAEA,iBAAO,SAAS,KAAA;AAAA,QAClB;AAAA,MAAA;AAGF,UAAI,KAAK,UAAU,MAAM,QAAQ,KAAK,IAAI,GAAG;AAC3C,cAAM,UAAU,KAAK,KAAK;AAAA,UACxB,CAAC,SAAiB,KAAK,SAAS,YAAY,KAAK,WAAW;AAAA,QAAA;AAE9D,cAAM,eAAe,EAAE,QAAQ,MAAM,MAAM,QAAA;AAE3CI,wBAAc,UAAU,YAAY;AACpC,eAAO,IAAI,KAAK,YAAY;AAAA,MAC9B;AAAA,IACF,SAAS,OAAO;AAEd,cAAQ,KAAK,+CAA+C,KAAK;AAAA,IACnE;AAEA,QAAI,KAAK,EAAE,QAAQ,OAAO,MAAM,CAAA,GAAI;AAAA,EACtC,SAAS,OAAO;AACd,YAAQ,MAAM,8BAA8B,KAAK;AACjD,QAAI,KAAK;AAAA,MACP,QAAQ;AAAA,MACR,MAAM,CAAA;AAAA,MACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IAAA,CACjD;AAAA,EACH;AACF;ACrGA,MAAMJ,oBAAkB;AAGxB,MAAM,oCAAoB,IAAA;AAI1B,MAAMC,cAAY,KAAK,KAAK;AAE5B,SAASC,iBAAe,MAAqB;AAC3C,SAAO,KAAK,UAAU,IAAI;AAC5B;AAEA,SAASC,gBAAc,KAAyB;AAC9C,QAAM,SAAS,cAAc,IAAI,GAAG;AACpC,MAAI,UAAU,KAAK,IAAA,IAAQ,OAAO,YAAYF,aAAW;AACvD,WAAO,OAAO;AAAA,EAChB;AACA,gBAAc,OAAO,GAAG;AACxB,SAAO;AACT;AAEA,SAASG,gBAAc,KAAa,MAAiB;AACnD,gBAAc,IAAI,KAAK,EAAE,MAAM,WAAW,KAAK,IAAA,GAAO;AACxD;AA2BO,MAAM,oBAAoC,OAAO,KAAK,QAAQ;AACnE,MAAI;AACF,UAAM,WAAWF,cAAY,UAAU;AAGvC,UAAM,aAAaC,gBAAc,QAAQ;AACzC,QAAI,YAAY;AACd,aAAO,IAAI,KAAK,UAAU;AAAA,IAC5B;AAGA,QAAI;AACF,YAAM,OAAyB,MAAM,aAAa;AAAA,QAChD;AAAA,QACA,YAAY;AACV,gBAAM,WAAW,MAAM,iBAAiB,GAAGH,iBAAe,aAAa,EAAE,SAAS,KAAO;AAEzF,cAAI,CAAC,SAAS,IAAI;AAChB,kBAAM,IAAI;AAAA,cACR,qCAAqC,SAAS,MAAM;AAAA,YAAA;AAAA,UAExD;AAEA,iBAAO,SAAS,KAAA;AAAA,QAClB;AAAA,MAAA;AAGF,UAAI,KAAK,UAAU,MAAM,QAAQ,KAAK,IAAI,GAAG;AAC3C,cAAM,iBAAiB,KAAK,KAAK;AAAA,UAC/B,CAAC,YAAY,QAAQ,mBAAmB;AAAA,QAAA;AAE1C,cAAM,eAAe,EAAE,QAAQ,MAAM,MAAM,eAAA;AAE3CI,wBAAc,UAAU,YAAY;AACpC,eAAO,IAAI,KAAK,YAAY;AAAA,MAC9B;AAAA,IACF,SAAS,OAAO;AAEd,cAAQ,KAAK,gDAAgD,KAAK;AAAA,IACpE;AAEA,QAAI,KAAK,EAAE,QAAQ,OAAO,MAAM,CAAA,GAAI;AAAA,EACtC,SAAS,OAAO;AACd,YAAQ,MAAM,+BAA+B,KAAK;AAClD,QAAI,KAAK;AAAA,MACP,QAAQ;AAAA,MACR,MAAM,CAAA;AAAA,MACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IAAA,CACjD;AAAA,EACH;AACF;ACrGA,MAAMJ,oBAAkB;AAGxB,MAAM,sCAAsB,IAAA;AAI5B,MAAMC,cAAY,KAAK,KAAK;AAE5B,SAASC,iBAAe,MAAqB;AAC3C,SAAO,KAAK,UAAU,IAAI;AAC5B;AAEA,SAASC,gBAAc,KAAyB;AAC9C,QAAM,SAAS,gBAAgB,IAAI,GAAG;AACtC,MAAI,UAAU,KAAK,IAAA,IAAQ,OAAO,YAAYF,aAAW;AACvD,WAAO,OAAO;AAAA,EAChB;AACA,kBAAgB,OAAO,GAAG;AAC1B,SAAO;AACT;AAEA,SAASG,gBAAc,KAAa,MAAiB;AACnD,kBAAgB,IAAI,KAAK,EAAE,MAAM,WAAW,KAAK,IAAA,GAAO;AAC1D;AAeO,MAAM,sBAAsC,OAAO,KAAK,QAAQ;AACrE,MAAI;AACF,UAAM,WAAWF,cAAY,YAAY;AAGzC,UAAM,aAAaC,gBAAc,QAAQ;AACzC,QAAI,YAAY;AACd,aAAO,IAAI,KAAK,UAAU;AAAA,IAC5B;AAGA,QAAI;AACF,YAAM,OAA2B,MAAM,aAAa;AAAA,QAClD;AAAA,QACA,YAAY;AACV,gBAAM,WAAW,MAAM,iBAAiB,GAAGH,iBAAe,eAAe,EAAE,SAAS,KAAO;AAE3F,cAAI,CAAC,SAAS,IAAI;AAChB,kBAAM,IAAI;AAAA,cACR,qCAAqC,SAAS,MAAM;AAAA,YAAA;AAAA,UAExD;AAEA,iBAAO,SAAS,KAAA;AAAA,QAClB;AAAA,MAAA;AAGF,UAAI,KAAK,UAAU,MAAM,QAAQ,KAAK,IAAI,GAAG;AAC3C,cAAM,eAAe,EAAE,QAAQ,MAAM,MAAM,KAAK,KAAA;AAEhDI,wBAAc,UAAU,YAAY;AACpC,eAAO,IAAI,KAAK,YAAY;AAAA,MAC9B;AAAA,IACF,SAAS,OAAO;AAEd,cAAQ,KAAK,kDAAkD,KAAK;AAAA,IACtE;AAEA,QAAI,KAAK,EAAE,QAAQ,OAAO,MAAM,CAAA,GAAI;AAAA,EACtC,SAAS,OAAO;AACd,YAAQ,MAAM,iCAAiC,KAAK;AACpD,QAAI,KAAK;AAAA,MACP,QAAQ;AAAA,MACR,MAAM,CAAA;AAAA,MACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IAAA,CACjD;AAAA,EACH;AACF;AAEO,MAAM,yBAAyC,OAAO,KAAK,QAAQ;AACxE,MAAI;AACF,UAAM,WAAWF,cAAY,gBAAgB;AAG7C,UAAM,aAAaC,gBAAc,QAAQ;AACzC,QAAI,YAAY;AACd,aAAO,IAAI,KAAK,UAAU;AAAA,IAC5B;AAGA,QAAI;AACF,YAAM,OAA8B,MAAM,aAAa;AAAA,QACrD;AAAA,QACA,YAAY;AACV,gBAAM,WAAW,MAAM,iBAAiB,GAAGH,iBAAe,mBAAmB,EAAE,SAAS,KAAO;AAE/F,cAAI,CAAC,SAAS,IAAI;AAChB,kBAAM,IAAI;AAAA,cACR,qCAAqC,SAAS,MAAM;AAAA,YAAA;AAAA,UAExD;AAEA,iBAAO,SAAS,KAAA;AAAA,QAClB;AAAA,MAAA;AAGF,UAAI,KAAK,UAAU,MAAM,QAAQ,KAAK,IAAI,GAAG;AAC3C,cAAM,eAAe,EAAE,QAAQ,MAAM,MAAM,KAAK,KAAA;AAEhDI,wBAAc,UAAU,YAAY;AACpC,eAAO,IAAI,KAAK,YAAY;AAAA,MAC9B;AAAA,IACF,SAAS,OAAO;AAEd,cAAQ,KAAK,sDAAsD,KAAK;AAAA,IAC1E;AAEA,QAAI,KAAK,EAAE,QAAQ,OAAO,MAAM,CAAA,GAAI;AAAA,EACtC,SAAS,OAAO;AACd,YAAQ,MAAM,oCAAoC,KAAK;AACvD,QAAI,KAAK;AAAA,MACP,QAAQ;AAAA,MACR,MAAM,CAAA;AAAA,MACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IAAA,CACjD;AAAA,EACH;AACF;AA8BO,MAAM,gCAAgD,OAAO,KAAK,QAAQ;AAC/E,MAAI;AACF,UAAM,EAAE,eAAe,IAAI;AAC3B,UAAM,WAAWF,cAAY,0BAA0B,UAAU;AAGjE,UAAM,aAAaC,gBAAc,QAAQ;AACzC,QAAI,YAAY;AACd,aAAO,IAAI,KAAK,UAAU;AAAA,IAC5B;AAGA,QAAI;AACF,YAAM,OAAqC,MAAM,aAAa;AAAA,QAC5D,0BAA0B,UAAU;AAAA,QACpC,YAAY;AACV,gBAAM,WAAW,MAAM;AAAA,YACrB,GAAGH,iBAAe,6BAA6B,UAAU;AAAA,YACzD,EAAE,SAAS,IAAA;AAAA,UAAM;AAGnB,cAAI,CAAC,SAAS,IAAI;AAChB,kBAAM,IAAI;AAAA,cACR,qCAAqC,SAAS,MAAM;AAAA,YAAA;AAAA,UAExD;AAEA,iBAAO,SAAS,KAAA;AAAA,QAClB;AAAA,MAAA;AAGF,UAAI,KAAK,UAAU,KAAK,MAAM;AAC5B,cAAM,eAAe,EAAE,QAAQ,MAAM,MAAM,KAAK,KAAA;AAEhDI,wBAAc,UAAU,YAAY;AACpC,eAAO,IAAI,KAAK,YAAY;AAAA,MAC9B;AAAA,IACF,SAAS,OAAO;AAEd,cAAQ;AAAA,QACN;AAAA,QACA;AAAA,MAAA;AAAA,IAEJ;AAEA,QAAI,KAAK,EAAE,QAAQ,OAAO,MAAM,MAAM;AAAA,EACxC,SAAS,OAAO;AACd,YAAQ,MAAM,2CAA2C,KAAK;AAC9D,QAAI,KAAK;AAAA,MACP,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IAAA,CACjD;AAAA,EACH;AACF;AC3NA,MAAM,kBAAkB;AAGxB,MAAM,mCAAmB,IAAA;AAIzB,MAAM,YAAY,IAAI,KAAK;AAE3B,SAAS,eAAe,MAAqB;AAC3C,SAAO,KAAK,UAAU,IAAI;AAC5B;AAEA,SAAS,cAAc,KAAyB;AAC9C,QAAM,SAAS,aAAa,IAAI,GAAG;AACnC,MAAI,UAAU,KAAK,IAAA,IAAQ,OAAO,YAAY,WAAW;AACvD,WAAO,OAAO;AAAA,EAChB;AACA,eAAa,OAAO,GAAG;AACvB,SAAO;AACT;AAEA,SAAS,cAAc,KAAa,MAAiB;AACnD,eAAa,IAAI,KAAK,EAAE,MAAM,WAAW,KAAK,IAAA,GAAO;AACvD;AAmDO,MAAM,0BAA0C,OAAO,KAAK,QAAQ;AACzE,MAAI;AACF,UAAM,EAAE,cAAc,IAAI;AAC1B,UAAM,OAAO,IAAI,MAAM,QAAQ;AAE/B,UAAM,WAAW,YAAY,WAAW,WAAW,IAAI;AAGvD,UAAM,aAAa,cAAc,QAAQ;AACzC,QAAI,YAAY;AACd,aAAO,IAAI,KAAK,UAAU;AAAA,IAC5B;AAGA,QAAI;AACF,YAAM,OAAwB,MAAM,aAAa;AAAA,QAC/C,WAAW,SAAS;AAAA,QACpB,YAAY;AACV,gBAAM,WAAW,MAAM;AAAA,YACrB,GAAG,eAAe,aAAa,SAAS,iBAAiB,IAAI;AAAA,YAC7D;AAAA,cACE,QAAQ;AAAA,cACR,SAAS;AAAA,gBACP,QAAQ;AAAA,gBACR,gBAAgB;AAAA,cAAA;AAAA,cAElB,SAAS;AAAA,YAAA;AAAA,UACX;AAGF,cAAI,CAAC,SAAS,IAAI;AAChB,kBAAM,IAAI;AAAA,cACR,qCAAqC,SAAS,MAAM;AAAA,YAAA;AAAA,UAExD;AAEA,iBAAO,SAAS,KAAA;AAAA,QAClB;AAAA,MAAA;AAGF,UAAI,SAAS,KAAK,UAAU,KAAK,UAAU;AAEzC,sBAAc,UAAU,IAAI;AAC5B,eAAO,IAAI,KAAK,IAAI;AAAA,MACtB;AAAA,IACF,SAAS,OAAO;AAEd,cAAQ;AAAA,QACN;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAAA,IAEJ;AAEA,QAAI,KAAK,EAAE,QAAQ,OAAO,SAAS,CAAA,GAAI;AAAA,EACzC,SAAS,OAAO;AACd,YAAQ,MAAM,qCAAqC,KAAK;AACxD,QAAI,KAAK;AAAA,MACP,QAAQ;AAAA,MACR,SAAS,CAAA;AAAA,MACT,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IAAA,CACjD;AAAA,EACH;AACF;AAEO,MAAM,sBAAsC,OAAO,KAAK,QAAQ;AACrE,MAAI;AACF,UAAM,EAAE,cAAc,IAAI;AAC1B,UAAM,QAAQ,IAAI,QAAQ,eAAe,QAAQ,WAAW,EAAE;AAE9D,QAAI,CAAC,OAAO;AACV,aAAO,IAAI,OAAO,GAAG,EAAE,KAAK;AAAA,QAC1B,QAAQ;AAAA,QACR,SAAS;AAAA,MAAA,CACV;AAAA,IACH;AAEA,UAAM,WAAW,MAAM;AAAA,MACrB,GAAG,eAAe,aAAa,SAAS;AAAA,MACxC;AAAA,QACE,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,QAAQ;AAAA,UACR,gBAAgB;AAAA,UAChB,eAAe,UAAU,KAAK;AAAA,QAAA;AAAA,QAEhC,SAAS;AAAA,MAAA;AAAA,IACX;AAGF,QAAI,CAAC,SAAS,IAAI;AAChB,YAAM,IAAI,MAAM,qCAAqC,SAAS,MAAM,EAAE;AAAA,IACxE;AAEA,UAAM,OAAO,MAAM,SAAS,KAAA;AAC5B,QAAI,KAAK,IAAI;AAAA,EACf,SAAS,OAAO;AACd,YAAQ,MAAM,gDAAgD,KAAK;AACnE,QAAI,OAAO,GAAG,EAAE,KAAK;AAAA,MACnB,QAAQ;AAAA,MACR,MAAM;AAAA,MACN,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IAAA,CACjD;AAAA,EACH;AACF;AAEO,MAAM,6BAA6C,OAAO,KAAK,QAAQ;AAC5E,MAAI;AACF,UAAM,EAAE,cAAc,IAAI;AAC1B,UAAM,EAAE,QAAQ,SAAS,aAAa,WAAA,IAAe,IAAI;AACzD,UAAM,QAAQ,IAAI,QAAQ,eAAe,QAAQ,WAAW,EAAE;AAE9D,UAAM,UAAkC;AAAA,MACtC,QAAQ;AAAA,MACR,gBAAgB;AAAA,IAAA;AAGlB,UAAM,OAAY;AAAA,MAChB;AAAA,MACA,SAAS,WAAW;AAAA,IAAA;AAGtB,QAAI,OAAO;AACT,cAAQ,gBAAgB,UAAU,KAAK;AAAA,IACzC,WAAW,eAAe,YAAY;AACpC,WAAK,cAAc;AACnB,WAAK,aAAa;AAAA,IACpB,OAAO;AACL,aAAO,IAAI,OAAO,GAAG,EAAE,KAAK;AAAA,QAC1B,QAAQ;AAAA,QACR,SAAS;AAAA,MAAA,CACV;AAAA,IACH;AAEA,UAAM,WAAW,MAAM;AAAA,MACrB,GAAG,eAAe,aAAa,SAAS;AAAA,MACxC;AAAA,QACE,QAAQ;AAAA,QACR;AAAA,QACA,MAAM,KAAK,UAAU,IAAI;AAAA,QACzB,SAAS;AAAA,MAAA;AAAA,IACX;AAGF,QAAI,CAAC,SAAS,IAAI;AAChB,YAAM,YAAY,MAAM,SAAS,KAAA;AACjC,YAAM,IAAI;AAAA,QACR,UAAU,WAAW,cAAc,SAAS,MAAM;AAAA,MAAA;AAAA,IAEtD;AAEA,UAAM,OAAO,MAAM,SAAS,KAAA;AAC5B,QAAI,KAAK,IAAI;AAAA,EACf,SAAS,OAAO;AACd,YAAQ,MAAM,mCAAmC,KAAK;AACtD,QAAI,OAAO,GAAG,EAAE,KAAK;AAAA,MACnB,QAAQ;AAAA,MACR,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IAAA,CACjD;AAAA,EACH;AACF;AAEO,MAAM,qBAAqC,OAAO,KAAK,QAAQ;AACpE,MAAI;AACF,UAAM,EAAE,aAAa,IAAI;AACzB,UAAM,QAAQ,IAAI,QAAQ,eAAe,QAAQ,WAAW,EAAE;AAE9D,QAAI,CAAC,OAAO;AACV,aAAO,IAAI,OAAO,GAAG,EAAE,KAAK;AAAA,QAC1B,QAAQ;AAAA,QACR,SAAS;AAAA,MAAA,CACV;AAAA,IACH;AAEA,UAAM,WAAW,MAAM,iBAAiB,GAAG,eAAe,YAAY,QAAQ,IAAI;AAAA,MAChF,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,QAAQ;AAAA,QACR,gBAAgB;AAAA,QAChB,eAAe,UAAU,KAAK;AAAA,MAAA;AAAA,MAEhC,SAAS;AAAA,IAAA,CACV;AAED,QAAI,CAAC,SAAS,IAAI;AAChB,YAAM,IAAI,MAAM,qCAAqC,SAAS,MAAM,EAAE;AAAA,IACxE;AAEA,QAAI,KAAK,EAAE,QAAQ,MAAM,SAAS,+BAA+B;AAAA,EACnE,SAAS,OAAO;AACd,YAAQ,MAAM,0BAA0B,KAAK;AAC7C,QAAI,OAAO,GAAG,EAAE,KAAK;AAAA,MACnB,QAAQ;AAAA,MACR,OAAO,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IAAA,CACjD;AAAA,EACH;AACF;ACrQO,SAAS,eAAe;AAC7B,QAAMC,OAAMC,iBAAA;AAGZ,EAAAD,KAAI,IAAI,MAAM;AACd,EAAAA,KAAI,IAAIC,iBAAQ,MAAM;AACtB,EAAAD,KAAI,IAAIC,iBAAQ,WAAW,EAAE,UAAU,KAAA,CAAM,CAAC;AAG9C,EAAAD,KAAI,IAAI,aAAa,CAAC,MAAM,QAAQ;AAClC,UAAM,OAAO,QAAQ,IAAI,gBAAgB;AACzC,QAAI,KAAK,EAAE,SAAS,KAAA,CAAM;AAAA,EAC5B,CAAC;AAED,EAAAA,KAAI,IAAI,aAAa,UAAU;AAC/B,EAAAA,KAAI,IAAI,cAAc,gBAAgB;AACtC,EAAAA,KAAI,IAAI,iBAAiB,iBAAiB;AAC1C,EAAAA,KAAI,IAAI,mBAAmB,mBAAmB;AAC9C,EAAAA,KAAI,IAAI,uBAAuB,sBAAsB;AACrD,EAAAA,KAAI,IAAI,6CAA6C,6BAA6B;AAGlF,EAAAA,KAAI,IAAI,oCAAoC,uBAAuB;AACnE,EAAAA,KAAI,IAAI,sCAAsC,mBAAmB;AACjE,EAAAA,KAAI,KAAK,oCAAoC,0BAA0B;AACvE,EAAAA,KAAI,OAAO,0BAA0B,kBAAkB;AAEvD,SAAOA;AACT;ACtCA,MAAM,MAAM,aAAA;AACZ,MAAM,OAAO,QAAQ,IAAI,QAAQ;AAGjC,MAAME,cAAY,YAAY;AAC9B,MAAM,WAAW,KAAK,KAAKA,aAAW,QAAQ;AAG9C,IAAI,IAAI,QAAQ,OAAO,QAAQ,CAAC;AAGhC,IAAI,IAAI,KAAK,CAAC,KAAK,QAAQ;AAEzB,MAAI,IAAI,KAAK,WAAW,OAAO,KAAK,IAAI,KAAK,WAAW,SAAS,GAAG;AAClE,WAAO,IAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,0BAA0B;AAAA,EACjE;AAEA,MAAI,SAAS,KAAK,KAAK,UAAU,YAAY,CAAC;AAChD,CAAC;AAED,IAAI,OAAO,MAAM,MAAM;AACrB,UAAQ,IAAI,4CAA4C,IAAI,EAAE;AAC9D,UAAQ,IAAI,iCAAiC,IAAI,EAAE;AACnD,UAAQ,IAAI,4BAA4B,IAAI,MAAM;AACpD,CAAC;AAGD,QAAQ,GAAG,WAAW,MAAM;AAC1B,UAAQ,IAAI,+CAA+C;AAC3D,UAAQ,KAAK,CAAC;AAChB,CAAC;AAED,QAAQ,GAAG,UAAU,MAAM;AACzB,UAAQ,IAAI,8CAA8C;AAC1D,UAAQ,KAAK,CAAC;AAChB,CAAC;"}